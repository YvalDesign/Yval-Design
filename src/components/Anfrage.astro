---
import Layout from "../layouts/main.astro";
---

<h2>LASST UNS <br /> <span class="quatschen">quatschen</span></h2>

<form id="contact" action="/api/contact" method="POST" novalidate>
  <div class="form">
    <div class="field">
      <label for="firstName" class="sr-only">Vorame</label>
      <input
        id="firstName"
        name="firstName"
        type="text"
        placeholder="Vorname"
        autocomplete="given-name"
        required
      />
      <p class="error" id="err-firstName" hidden>
        Bitte gib deinen Vornamen ein.
      </p>
    </div>
    <div class="field">
      <label for="lastName" class="sr-only">Nachname</label>
      <input
        id="lastName"
        name="lastName"
        type="text"
        placeholder="Nachname"
        autocomplete="family-name"
        required
      />
      <p class="error" id="err-lastName" hidden>Bitte gib deinen Namen ein.</p>
    </div>
    <div class="field">
      <label for="phone" class="sr-only">Telefonnummer</label>
      <input
        id="phone"
        name="phone"
        type="tel"
        placeholder="Telefonnummer"
        autocomplete="tel"
        inputmode="tel"
        required
      />
      <p class="error" id="err-phone" hidden>
        Bitte gib deine Telefonnummer ein.
      </p>
    </div>

    <div class="field">
      <label for="email" class="sr-only">E-Mail</label>
      <input
        id="email"
        name="email"
        type="email"
        placeholder="E-Mail"
        autocomplete="email"
        required
        spellcheck="false"
      />
      <p class="error" id="err-email" hidden>
        Bitte gib eine gültige E-Mail an.
      </p>
    </div>

    <div class="field wide">
      <label for="message" class="sr-only">Nachricht</label>
      <textarea
        id="message"
        name="message"
        rows="5"
        placeholder="Erzähl uns von deinem Problem!"
        required></textarea>
      <p class="error" id="err-message" hidden>Bitte schreib eine Nachricht.</p>
    </div>
  </div>

  <div class="budget">
    <h3>DEIN BUDGET</h3>
    <div class="budgetoptions">
      <label class="radio">
        <input type="radio" name="budget" value="1500" required />
        <span>1.500€</span>
      </label>

      <label class="radio">
        <input type="radio" name="budget" value="3000" required />
        <span>3.000€</span>
      </label>

      <label class="radio">
        <input type="radio" name="budget" value="5000" required />
        <span>5.000€</span>
      </label>
      <label class="radio">
        <input type="radio" name="budget" value="8000" required />
        <span>8.000€</span>
      </label>
      <label class="radio">
        <input type="radio" name="budget" value="15000" required />
        <span>15.000€</span>
      </label>
      <label class="radio">
        <input type="radio" name="budget" value="20000+" required />
        <span>20.000€</span>
      </label>
    </div>

    <p class="error" id="err-budget" hidden>Bitte wähle ein Budget aus.</p>
  </div>

  <!-- Honeypot gegen Spam (für Menschen unsichtbar) -->
  <div aria-hidden="true" style="position:absolute; left:-9999px;">
    <label for="hp">Lass dieses Feld leer</label>
    <input id="hp" name="company" tabindex="-1" autocomplete="off" />
  </div>

  <p class="info">
    Mit dem Absenden des Formulars erklärst du dich damit einverstanden, dass
    wir deine Angaben zur Beantwortung deiner Anfrage verarbeiten. Weitere
    Informationen findest du in unserer Datenschutzerklärung.
  </p>

  <button type="submit">AUF ZUM MOND!</button>
  <p class="success" id="ok" hidden>Danke! Wir melden uns bald.</p>
</form>

<style>
  h2 {
    font-family: var(--gothic-wide);
    font-weight: var(--weight-bold);
    color: white;
    font-size: 9vw;
    margin-top: 30%;

    line-height: 60%;
    text-align: center;
  }
  .quatschen {
    font-family: var(--spills);
    color: var(--primary);
    font-weight: var(--weight-normal);
    font-size: 12vw;
  }
  @media (min-width: 701px) {
    h2 {
      font-size: 8vw;
    }
    .quatschen {
      font-size: 11vw;
    }
  }

  @media (min-width: 1200px) {
    h2 {
      font-size: 6vw;
    }
    .quatschen {
      font-size: 9vw;
    }
  }
  .form {
    max-width: 800px;
    padding-inline: 3vw;
    margin-inline: auto;
    display: grid;
    grid-template-columns: 1fr;
  }
  @media (min-width: 701px) {
    .form {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr 1fr;
      gap: 0.5rem;
    }
    .wide {
      grid-column: span 2;
      grid-row: span 2;
    }
  }
  .sr-only {
    position: absolute !important;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  .field {
    margin: 10px 0;
    display: grid;
    gap: 6px;
  }
  input,
  textarea {
    padding: 1rem 1.5rem;
    border: 1.5px solid white;
    background-color: var(--bg);
    border-radius: 18px;
    color: white;
  }

  input::placeholder,
  textarea::placeholder {
    color: var(--text-grey);
    font-family: var(--open);
  }
  .error {
    font-size: 0.9rem;
    color: white;
    font-family: var(--open);
  }
  .success {
    color: #0a0;
    margin-top: 10px;
  }
  input:invalid,
  textarea:invalid {
  }

  h3 {
    font-family: var(--gothic-wide);
    color: white;
    font-size: 7vw;
    justify-self: center;
  }

  .budget {
  }

  .budgetoptions {
    display: grid;
    max-width: 800px;
    padding-inline: 3vw;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr 1fr;
    gap: 2.5vw;
    margin-inline: auto;
  }
  @media (min-width: 701px) {
    .budgetoptions {
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr;
    }
  }
  .radio {
    border-radius: 20px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.15s ease;
    background: white;
    color: black;
  }

  span {
    font-family: var(--gothic-wide);
    font-weight: var(--weight-extrabold);
  }

  .radio:hover {
    background: var(--primary);
    transform: scale(1.05);
    transition: transform 150ms ease-in-out;
  }
  .radio input {
    display: none;
    color: var(--text-inv);
  }

  .radio:has(input:checked) {
    background: var(--primary);
  }

  .info {
    font-family: var(--open);
    font-size: 0.7rem;
    justify-self: center;
    color: white;
    max-width: 70ch;
    margin-top: 5%;
  }

  button {
    background: linear-gradient(
      to right,
      var(--primary),
      var(--secondary),
      var(--primary)
    );
    border: none;
    border-radius: 50px;
    color: white;

    font-family: var(--gothic-wide);
    font-weight: 800;
    display: block;
    margin-inline: auto;

    transform: scale(1);
    transition: transform 150ms ease-in-out;
    cursor: pointer;
  }

  @media (max-width: 700px) {
    button {
      font-size: 4vw;
      padding: 20px 40px;
      margin-top: 2rem;
    }
  }

  @media (min-width: 701px) {
    button {
      font-size: 3vw;
      padding: 25px 35px;
      margin-top: 4rem;
    }
  }

  @media (min-width: 1000px) {
    button {
      font-size: 2vw;
      padding: 30px 45px;
    }
  }

  button:hover {
    transform: scale(1.05);
    transition: all 150ms ease-in-out;
  }

  button:active {
    transform: scale(0.97);
  }
</style>

<script>
  const form = document.getElementById("contact");
  const fields = {
    firstName: {
      el: document.getElementById("firstName"),
      err: document.getElementById("err-firstName"),
    },
    lastName: {
      el: document.getElementById("lastName"),
      err: document.getElementById("err-lastName"),
    },
    email: {
      el: document.getElementById("email"),
      err: document.getElementById("err-email"),
    },
    phone: {
      el: document.getElementById("phone"),
      err: document.getElementById("err-phone"),
    },
    message: {
      el: document.getElementById("message"),
      err: document.getElementById("err-message"),
    },
  };
  const ok = document.getElementById("ok");

  function showValidity(f) {
    const el = f.el,
      err = f.err;
    const valid = el.checkValidity();
    err.hidden = valid;
    return valid;
  }

  Object.values(fields).forEach((f) => {
    f.el.addEventListener("input", () => showValidity(f));
    f.el.addEventListener("blur", () => showValidity(f));
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Client-Side Validierung
    const allValid = Object.values(fields).every(showValidity);
    if (!allValid) return;

    // Honeypot abfangen
    if (form.company && form.company.value) return;

    // Abschicken (AJAX)
    const data = {
      name: fields.name.el.value.trim(),
      email: fields.email.el.value.trim(),
      message: fields.msg.el.value.trim(),
    };

    try {
      const res = await fetch(form.action, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
        credentials: "same-origin",
      });
      if (!res.ok) throw new Error("Serverfehler");
      ok.hidden = false;
      form.reset();
    } catch (err) {
      alert("Senden fehlgeschlagen. Bitte später erneut versuchen.");
    }
  });
</script>
